Homework: 4.1: Limiting connections to a primary

Suppose you have a sharded cluster for which each shard is a 3-node replica set running MongoDB 2.6. You are concerned about limiting the number of connections in order to help ensure predictable behavior. Given the constraints of your system, you have decided to use 10GB to determine the maximum connections on the primary.

Using the formula discussed earlier in this chapter, determine the value to which you should set maxConns for the mongos in this cluster if you want to limit primary connections to a ~90% utilization level. Your cluster is using 64 mongos and the number of other possible connections to a primary is 6.

Please calculate the maxConns value to achieve 90% utilization and round down to the nearest integer. Enter only the integer in the box below or your answer will be considered incorrect.

Note: For consistency with the lesson video, please assume that 10,000 connections consume 10GB of RAM.

Answer:
=======

Note: For calculating max. number of mongos connections = maxPrimaryConnections - (numSecondarynodesinaRS * 3) - (numOtherconnections *3) // numMongos
maxPrimaryConnections - are limited by ulimit, memory, caps.

- Max. Primary Connections = 10,000 (From 10GB the limit here is memory)
- Num. of Secondaries in ReplicaSet = 2 (As each shard is a 3-node ReplicaSet)
- Num. of Other connections = 6 (From question)
- Num. of mongos hosts = 64 (From question)

Max. mongos Connections = (10,000 - (2*3) - (6*3))/64 = 9976/64 = 155.875

- As we have to use 90% of these: 155.875*0.9 = 140.2875 

- We need to round this: *140*
